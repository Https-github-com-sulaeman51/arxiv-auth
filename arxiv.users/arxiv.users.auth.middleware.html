
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>arxiv.users.auth.middleware module &#8212; arXiv AuthN/Z 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="arxiv.users.auth.scopes module" href="arxiv.users.auth.scopes.html" />
    <link rel="prev" title="arxiv.users.auth.exceptions module" href="arxiv.users.auth.exceptions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-arxiv.users.auth.middleware">
<span id="arxiv-users-auth-middleware-module"></span><h1>arxiv.users.auth.middleware module<a class="headerlink" href="#module-arxiv.users.auth.middleware" title="Permalink to this headline">¶</a></h1>
<p>Middleware for interpreting authn/z information on requestsself.</p>
<p>This module provides <a class="reference internal" href="#arxiv.users.auth.middleware.AuthMiddleware" title="arxiv.users.auth.middleware.AuthMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthMiddleware</span></code></a>, which unpacks encrypted JSON
Web Tokens provided via the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header. This is intended to
support requests that have been pre-authorized by the web server using the
authenticator service (see <a class="reference internal" href="../authenticator/authenticator.html#module-authenticator" title="authenticator"><code class="xref py py-mod docutils literal notranslate"><span class="pre">authenticator</span></code></a>).</p>
<p>The configuration parameter <code class="docutils literal notranslate"><span class="pre">JWT_SECRET</span></code> must be set in the WSGI request
environ (e.g. Apache’s SetEnv) or in the runtime environment. This must be
the same secret that was used by the authenticator service to mint the token.</p>
<p>To install the middleware, use the pattern described in
<a class="reference external" href="https://cul-it.github.io/arxiv-base/arxiv/arxiv.base.middleware.html#module-arxiv.base.middleware" title="(in arXiv base v0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">arxiv.base.middleware</span></code></a>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">arxiv.base</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">arxiv.base.middleware</span> <span class="kn">import</span> <span class="n">wrap</span>
<span class="kn">from</span> <span class="nn">arxiv.users</span> <span class="kn">import</span> <span class="n">auth</span>


<span class="k">def</span> <span class="nf">create_web_app</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Flask</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="n">Base</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">Auth</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">wrap</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="p">[</span><span class="n">auth</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">AuthMiddleware</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">app</span>
</pre></div>
</div>
<p>For convenience, this is intended to be used with
<a class="reference internal" href="arxiv.users.auth.decorators.html#module-arxiv.users.auth.decorators" title="arxiv.users.auth.decorators"><code class="xref py py-mod docutils literal notranslate"><span class="pre">arxiv.users.auth.decorators</span></code></a>.</p>
<dl class="class">
<dt id="arxiv.users.auth.middleware.AuthMiddleware">
<em class="property">class </em><code class="descclassname">arxiv.users.auth.middleware.</code><code class="descname">AuthMiddleware</code><span class="sig-paren">(</span><em>app</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/arxiv/users/auth/middleware.html#AuthMiddleware"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#arxiv.users.auth.middleware.AuthMiddleware" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://cul-it.github.io/arxiv-base/arxiv/arxiv.base.middleware.base.html#arxiv.base.middleware.base.BaseMiddleware" title="(in arXiv base v0.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">arxiv.base.middleware.base.BaseMiddleware</span></code></a></p>
<p>Middleware to handle auth information on requests.</p>
<p>Before the request is handled by the application, the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code>
header is parsed for an encrypted JWT. If successfully decrypted,
information about the user and their authorization scope is attached
to the request.</p>
<p>This can be accessed in the application via
<code class="docutils literal notranslate"><span class="pre">flask.request.environ['session']</span></code>.  If Authorization header was not
included, then that value will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>If the JWT could not be  decrypted, the value will be an
<code class="xref py py-class docutils literal notranslate"><span class="pre">Unauthorized</span></code> exception instance. We cannot raise the exception
here, because the middleware is executed outside of the Flask application.
It’s up to something running inside the application (e.g.
<a class="reference internal" href="arxiv.users.auth.decorators.html#arxiv.users.auth.decorators.scoped" title="arxiv.users.auth.decorators.scoped"><code class="xref py py-func docutils literal notranslate"><span class="pre">arxiv.users.auth.decorators.scoped()</span></code></a>) to raise the exception.</p>
<dl class="method">
<dt id="arxiv.users.auth.middleware.AuthMiddleware.before">
<code class="descname">before</code><span class="sig-paren">(</span><em>environ</em>, <em>start_response</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/arxiv/users/auth/middleware.html#AuthMiddleware.before"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#arxiv.users.auth.middleware.AuthMiddleware.before" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode and unpack the auth token on the request.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tuple</span></code>[<a class="reference external" href="https://docs.python.org/3.6/library/stdtypes.html#dict" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3.6/library/typing.html#typing.Callable" title="(in Python v3.6)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>]</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">arXiv AuthN/Z</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="arxiv.users.html">arxiv.users package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arxiv.users.html#quick-start">Quick start</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="arxiv.users.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="arxiv.users.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../accounts/accounts.html">Accounts Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authenticator/authenticator.html">Authenticator service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registry/registry.html">API client registry service</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="arxiv.users.html">arxiv.users package</a><ul>
  <li><a href="arxiv.users.auth.html">arxiv.users.auth package</a><ul>
      <li>Previous: <a href="arxiv.users.auth.exceptions.html" title="previous chapter">arxiv.users.auth.exceptions module</a></li>
      <li>Next: <a href="arxiv.users.auth.scopes.html" title="next chapter">arxiv.users.auth.scopes module</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, arXiv.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.8</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../_sources/arxiv.users/arxiv.users.auth.middleware.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>